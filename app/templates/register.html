{% extends "base.html" %}
{% block title %}Registreren{% endblock %}

{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div id="flash-messages" class="mt-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<div class="container mt-4">
    <h2>Account aanmaken</h2>

    <h4>Registreer met e-mail</h4>
    <form method="POST" novalidate>
        {{ form.hidden_tag() }}

        <div class="mb-3">
            {{ form.email.label(class="form-label") }}
            {{ form.email(class="form-control", placeholder="E-mailadres") }}
            {% for error in form.email.errors %}
                <div class="text-danger">{{ error }}</div>
            {% endfor %}
        </div>

        <div class="mb-3">
            {{ form.password.label(class="form-label") }}
            {{ form.password(class="form-control", placeholder="Wachtwoord") }}
            {% for error in form.password.errors %}
                <div class="text-danger">{{ error }}</div>
            {% endfor %}
        </div>

        <div class="mb-3">
            {{ form.confirm_password.label(class="form-label") }}
            {{ form.confirm_password(class="form-control", placeholder="Bevestig wachtwoord") }}
            {% for error in form.confirm_password.errors %}
                <div class="text-danger">{{ error }}</div>
            {% endfor %}
        </div>

        <button type="submit" class="btn btn-primary" id="register-button">
            Registreren
            <span id="register-spinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
        </button>
    </form>

    <hr>

    <h4>Of:</h4>
    <a href="{{ url_for('main.signin') }}" class="btn btn-danger">
    <i class="fab fa-google"></i> Registreren met Google
    </a>


    {% if form.errors %}
    <div class="alert alert-danger mt-3">
        <ul>
        {% for field, errors in form.errors.items() %}
            {% for error in errors %}
            <li>{{ field }}: {{ error }}</li>
            {% endfor %}
        {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>

<script>
// Spinner bij registratie
document.querySelector('form').addEventListener('submit', function() {
    const btn = document.getElementById('register-button');
    const spinner = document.getElementById('register-spinner');

    btn.disabled = true;
    spinner.classList.remove('d-none');
});
</script>
{% endblock %}
