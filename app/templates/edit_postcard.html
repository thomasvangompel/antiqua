{% extends "base.html" %}

{% block content %}
<div class="container py-4">
  <h2>Postkaart Bewerken</h2>

  <form method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}

    <!-- Titel -->
    <div class="mb-3">
      {{ form.title.label(class="form-label") }}
      {{ form.title(class="form-control", placeholder="Titel") }}
      {% for error in form.title.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- Beschrijving -->
    <div class="mb-3">
      {{ form.description.label(class="form-label") }}
      {{ form.description(class="form-control", rows=3, placeholder="Beschrijving (optioneel)") }}
      {% for error in form.description.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- Conditie -->
    <div class="mb-3">
      {{ form.condition.label(class="form-label") }}
      {{ form.condition(class="form-select") }}
      <div class="form-text">(optioneel)</div>
      {% for error in form.condition.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- Afbeeldingen -->
    <div class="mb-3">
      <label class="form-label d-block">Afbeeldingen van de postkaart</label>
      <div class="d-flex flex-wrap gap-3">
        <!-- Voorkant -->
        <div class="flex-grow-1" style="min-width: 120px;">
          <label for="{{ form.front_image.id }}" class="form-label fw-bold">Voorkant</label>
          {{ form.front_image(class="form-control") }}
          {% if postcard.front_image_url %}
            <img id="previewFront" src="{{ url_for('static', filename=postcard.front_image_url) }}" alt="Preview voorkant" class="img-fluid mt-2" style="max-height: 120px; object-fit: contain; border: 1px solid #ddd; border-radius: 4px;">
          {% else %}
            <img id="previewFront" src="#" alt="Preview voorkant" class="img-fluid mt-2" style="display:none; max-height: 120px; object-fit: contain; border: 1px solid #ddd; border-radius: 4px;">
          {% endif %}
          {% for error in form.front_image.errors %}
            <div class="text-danger">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Achterkant -->
        <div class="flex-grow-1" style="min-width: 120px;">
          <label for="{{ form.back_image.id }}" class="form-label fw-bold">Achterkant</label>
          {{ form.back_image(class="form-control") }}
          {% if postcard.back_image_url %}
            <img id="previewBack" src="{{ url_for('static', filename=postcard.back_image_url) }}" alt="Preview achterkant" class="img-fluid mt-2" style="max-height: 120px; object-fit: contain; border: 1px solid #ddd; border-radius: 4px;">
          {% else %}
            <img id="previewBack" src="#" alt="Preview achterkant" class="img-fluid mt-2" style="display:none; max-height: 120px; object-fit: contain; border: 1px solid #ddd; border-radius: 4px;">
          {% endif %}
          {% for error in form.back_image.errors %}
            <div class="text-danger">{{ error }}</div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Uitgever -->
    <div class="mb-3">
      {{ form.publisher.label(class="form-label") }}
      {{ form.publisher(class="form-control", placeholder="Uitgever (optioneel)") }}
      {% for error in form.publisher.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- Veiling Checkbox -->
    <div class="form-check mb-3">
      {{ form.is_auction(class="form-check-input", id="isAuctionCheck") }}
      <label class="form-check-label" for="isAuctionCheck">Bieden toestaan i.p.v. vaste prijs?</label>
      {% for error in form.is_auction.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- Vaste Prijs -->
    <div id="fixedPriceFields" class="mb-3">
      {{ form.price.label(class="form-label") }}
      {{ form.price(class="form-control", placeholder="Prijs in € (optioneel)") }}
      {% for error in form.price.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- Veiling Velden -->
    <div id="auctionFields" style="display: none;">
      <div class="mb-3">
        {{ form.auction_min_price.label(class="form-label") }}
        {{ form.auction_min_price(class="form-control", placeholder="Minimum veilingprijs (€)") }}
        {% for error in form.auction_min_price.errors %}
          <div class="text-danger">{{ error }}</div>
        {% endfor %}
      </div>

      <div class="mb-3">
        {{ form.auction_end.label(class="form-label") }}
        {{ form.auction_end(class="form-control", placeholder="YYYY-MM-DD HH:MM") }}
        <div class="form-text">(optioneel, formaat: 2025-08-06 14:30)</div>
        {% for error in form.auction_end.errors %}
          <div class="text-danger">{{ error }}</div>
        {% endfor %}
      </div>
    </div>

 

    <button type="submit" class="btn btn-primary" id="submitBtn">
      <span id="spinner" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true" style="display: none;"></span>
      {{ form.submit.label.text }}
    </button>
    <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary ms-2">Annuleren</a>
  </form>
</div>

<script>
  function previewImage(input, previewId) {
    const preview = document.getElementById(previewId);
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
        preview.src = e.target.result;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(input.files[0]);
    } else {
      preview.style.display = 'none';
    }
  }

  document.querySelector('input[name="{{ form.front_image.name }}"]').addEventListener('change', function () {
    previewImage(this, 'previewFront');
  });

  document.querySelector('input[name="{{ form.back_image.name }}"]').addEventListener('change', function () {
    previewImage(this, 'previewBack');
  });

  const isAuctionCheckbox = document.getElementById('isAuctionCheck');
  const fixedPriceFields = document.getElementById('fixedPriceFields');
  const auctionFields = document.getElementById('auctionFields');

  function toggleFields() {
    if (isAuctionCheckbox.checked) {
      fixedPriceFields.style.display = 'none';
      auctionFields.style.display = 'block';
    } else {
      fixedPriceFields.style.display = 'block';
      auctionFields.style.display = 'none';
    }
  }

  isAuctionCheckbox.addEventListener('change', toggleFields);
  window.addEventListener('load', toggleFields);

  // Spinner on submit
  const form = document.querySelector('form');
  const spinner = document.getElementById('spinner');
  const submitBtn = document.getElementById('submitBtn');

  form.addEventListener('submit', () => {
    submitBtn.disabled = true;
    spinner.style.display = 'inline-block';
  });
</script>
{% endblock %}
