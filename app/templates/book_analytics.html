{% extends "base.html" %}

{% block title %}Analyse {{ book.title }}{% endblock %}

{% block content %}
<h2>Analyse voor "{{ book.title }}"</h2>

<p>Totaal aantal views: {{ book.view_count or 0 }}</p>

<h3>Views per dag (laatste 7 dagen)</h3>
<canvas id="viewsPerDayChart" width="600" height="300"></canvas>

<h3>Views per uur (vandaag)</h3>
<canvas id="viewsPerHourChart" width="600" height="300"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Data vanuit Flask naar JS
  const viewsPerDayData = {{ views_per_day | tojson }};
  const viewsPerHourData = {{ views_per_hour | tojson }};
  
  // Helper: labels en data per dag maken (vul ontbrekende dagen met 0)
  const getLast7DaysLabels = () => {
    const labels = [];
    for (let i = 6; i >= 0; i--) {
      const d = new Date();
      d.setDate(d.getDate() - i);
      labels.push(d.toISOString().slice(0,10));
    }
    return labels;
  }
  const dayLabels = getLast7DaysLabels();
  const dayCounts = dayLabels.map(label => viewsPerDayData[label] || 0);

  // Chart views per dag
  const ctxDay = document.getElementById('viewsPerDayChart').getContext('2d');
  new Chart(ctxDay, {
    type: 'bar',
    data: {
      labels: dayLabels,
      datasets: [{
        label: 'Aantal views per dag',
        data: dayCounts,
        backgroundColor: 'rgba(54, 162, 235, 0.7)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: { y: { beginAtZero: true } }
    }
  });

  // Labels en data per uur (0-23)
  const hourLabels = [...Array(24).keys()];
  const hourCounts = hourLabels.map(h => viewsPerHourData[h] || 0);

  // Chart views per uur
  const ctxHour = document.getElementById('viewsPerHourChart').getContext('2d');
  new Chart(ctxHour, {
    type: 'bar',
    data: {
      labels: hourLabels.map(h => h + ":00"),
      datasets: [{
        label: 'Aantal views per uur',
        data: hourCounts,
        backgroundColor: 'rgba(255, 159, 64, 0.7)',
        borderColor: 'rgba(255, 159, 64, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: { y: { beginAtZero: true } }
    }
  });
</script>
{% endblock %}
