{% for afspraak in afspraken %}
  <li class="list-group-item">
    Boek: {{ afspraak.book.title if afspraak.book else '-' }}<br>
    Datum: {{ '%02d-%02d-%04d'|format(afspraak.day, afspraak.month+1, afspraak.year) }}<br>
    Tijd: {{ afspraak.time }}<br>
    <button class="btn btn-sm btn-outline-danger me-2" data-bs-toggle="modal" data-bs-target="#deleteModal{{ afspraak.id }}">Verwijder</button>
    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#changeModal{{ afspraak.id }}">Wijzig tijdslot</button>

    <!-- Verwijder Modal -->
    <div class="modal fade" id="deleteModal{{ afspraak.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ afspraak.id }}" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form method="POST" action="{{ url_for('main.delete_appointment', appointment_id=afspraak.id) }}">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteModalLabel{{ afspraak.id }}">Reden van annulering</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Sluiten"></button>
            </div>
            <div class="modal-body">
              <textarea name="reden" class="form-control" placeholder="Geef een reden op..." required></textarea>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuleer</button>
              <button type="submit" class="btn btn-danger">Verwijder afspraak</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Wijzig tijdslot Modal -->
    <div class="modal fade" id="changeModal{{ afspraak.id }}" tabindex="-1" aria-labelledby="changeModalLabel{{ afspraak.id }}" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form method="POST" action="{{ url_for('main.change_appointment', appointment_id=afspraak.id) }}">
            <div class="modal-header">
              <h5 class="modal-title" id="changeModalLabel{{ afspraak.id }}">Kies een nieuw tijdslot</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Sluiten"></button>
            </div>
            <div class="modal-body">
              <select name="nieuw_tijdslot" class="form-select" required>
                {% for slot in afspraak.book.available_slots %}
                      <option value="{{ slot.id }}">{{ '%02d-%02d-%04d'|format(slot.day, slot.month+1, slot.year) }} om {{ slot.time }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuleer</button>
                  <button type="submit" class="btn btn-primary">Wijzig tijdslot</button>
                </div>
              </form>
            </div>
          </div>
        </div>
  </li>
{% endfor %}
{% extends "base.html" %}

{% block content %}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="container mt-3">
        {% for category, message in messages %}
          {% if category == 'success' %}
            <div id="flash-messages" class="alert alert-success">{{ message }}</div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="container py-4">
    <div class="d-flex flex-column flex-md-row align-items-center mb-4">
      <!-- Profielfoto -->
      <img src="{{ url_for('static', filename='profile_pics/' + user.image_file) }}" alt="Profielfoto" class="profile-pic" />

      <!-- Welkom & knoppen -->
      <div class="ms-md-4 mt-3 mt-md-0">
        <h2>Hallo, {{ user.username or "Nieuweling"}}!</h2>
        <div class="d-flex flex-wrap align-items-center mt-2">
          <a href="{{ url_for('main.profile') }}" class="btn btn-primary me-2 mb-2">Bewerk profiel</a>
          
          {% if user.business_name %}
            <a href="{{ url_for('main.beheer_antiquariaat') }}" class="btn btn-outline-dark me-2 mb-2">Beheer Antiquariaat</a>
          {% endif %}
          <a href="{{ url_for('main.start_search') }}" class="btn btn-lg btn-success me-2 mb-2" style="font-size:1.2rem; padding:0.4rem 1rem;">Start met zoeken</a>
        </div>
      </div>

      </div>
    </div>

    <hr>

    <!-- Actieknoppen sectie -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h3>Mijn Collectie</h3>
        <p class="text-muted mb-0">Beheer je boeken, postkaarten, posters en categorieën</p>
        <!-- Categorieën sectie verwijderd -->
      </div>
      <div>
        <a href="{{ url_for('main.new_book') }}" class="btn btn-outline-success me-2">+ Boek</a>
        <a href="{{ url_for('main.add_postcard') }}" class="btn btn-outline-success me-2">+ Postkaart</a>
        <a href="{{ url_for('main.add_poster') }}" class="btn btn-outline-success me-2">+ Poster</a>
        <a href="{{ url_for('main.add_art') }}" class="btn btn-outline-success">+ Kunst</a>
      </div>
    </div>

    {# ------------------- BOEKEN ------------------- #}
    {% set beschikbare_boeken = boeken | selectattr('sold', 'equalto', False) | list %}
    {% set verkochte_boeken = boeken | selectattr('sold', 'equalto', True) | list %}

    <h4 class="mt-4"> Mijn Boeken</h4>
    {% if beschikbare_boeken %}
      <ul class="list-inline mt-4 mb-4">
        <li class="list-inline-item fw-bold">Mijn Boeken</li>
      </ul>
      <div class="list-group">
        {% for boek in beschikbare_boeken %}
          <div class="list-group-item list-group-item-action flex-column align-items-start mb-3 rounded shadow-sm p-3">
            <h5 class="mb-1">{{ boek.title }}</h5>
            <small class="text-muted mb-2 d-block">door {{ boek.author }}</small>

            <div class="d-flex align-items-start mb-2">
              {% if boek.front_image %}
                <img src="{{ url_for('static', filename='uploads/' ~ boek.front_image) }}" alt="Boekvoorkant" class="me-3 rounded" style="width: 80px; height: auto; object-fit: cover;">
              {% endif %}
              <div>
                <p class="mb-0">
                  {% if boek.description %}
                    {{ boek.description.split()[:10] | join(' ') }}...
                  {% else %}
                    Geen beschrijving
                  {% endif %}
                </p>
              </div>
            </div>

            <div class="mt-2">
              <a href="{{ url_for('main.edit_book', book_id=boek.id) }}" class="btn btn-sm btn-outline-primary me-2">Bewerk</a>
              <a href="{{ url_for('main.book_analytics', book_id=boek.id) }}" class="btn btn-sm btn-outline-info me-2">Analyseer</a>
              <form action="{{ url_for('main.delete_book', book_id=boek.id) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Weet je zeker dat je dit boek wilt verwijderen?');">Verwijder</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
  {% endif %}

  {# ------------------- POSTKAARTEN ------------------- #}
    {% set beschikbare_postkaarten = postkaarten | selectattr('sold', 'equalto', False) | list %}
    {% set verkochte_postkaarten = postkaarten | selectattr('sold', 'equalto', True) | list %}

    <h4 class="mt-5"> Mijn Postkaarten</h4>
    {% if beschikbare_postkaarten %}
      <ul class="list-inline mt-5 mb-4">
        <li class="list-inline-item fw-bold">Mijn Postkaarten</li>
      </ul>
      <div class="list-group">
        {% for kaart in beschikbare_postkaarten %}
          <div class="list-group-item list-group-item-action flex-column align-items-start mb-3 rounded shadow-sm p-3">
            <h5 class="mb-1">{{ kaart.title or 'Geen titel' }}</h5>
            <small class="text-muted mb-2 d-block">{{ kaart.publisher}}</small>

            {% if kaart.front_image_url %}
              <img src="{{ url_for('static', filename=kaart.front_image_url) }}" alt="Voorkant" class="me-3 rounded" style="width: 80px; height: auto; object-fit: cover;">
            {% endif %}

            <p class="mb-0">
              Staat: {{ kaart.condition or 'Onbekend' }}<br>
              Jaar: {{ kaart.year or 'n.v.t.' }}
            </p>

            <div class="mt-2">
              <a href="{{ url_for('main.edit_postcard', postcard_id=kaart.id) }}" class="btn btn-sm btn-outline-primary me-2">Bewerk</a>
              <form action="{{ url_for('main.delete_postcard', postcard_id=kaart.id) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Weet je zeker dat je deze postkaart wilt verwijderen?');">Verwijder</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
  {% endif %}

  {# ------------------- POSTERS ------------------- #}
    {% set beschikbare_posters = posters | selectattr('sold', 'equalto', False) | list %}
    {% set verkochte_posters = posters | selectattr('sold', 'equalto', True) | list %}

    <h4 class="mt-5"> Mijn Posters</h4>
    {% if beschikbare_posters %}
      <ul class="list-inline mt-5 mb-4">
        <li class="list-inline-item fw-bold">Mijn Posters</li>
      </ul>
      <div class="list-group">
        {% for poster in beschikbare_posters %}
          <div class="list-group-item list-group-item-action flex-column align-items-start mb-3 rounded shadow-sm p-3">
            <h5 class="mb-1">{{ poster.title or 'Geen titel' }}</h5>
            <small class="text-muted mb-2 d-block">{{ poster.publisher}}</small>

            {% if poster.front_image_url %}
              <img src="{{ url_for('static', filename=poster.front_image_url) }}" alt="Voorkant" class="me-3 rounded" style="width: 80px; height: auto; object-fit: cover;">
            {% endif %}

            <p class="mb-0">
              Staat: {{ poster.condition or 'Onbekend' }}<br>
              Jaar: {{ poster.year or 'n.v.t.' }}
            </p>

            <div class="mt-2">
              <a href="{{ url_for('main.edit_poster', poster_id=poster.id) }}" class="btn btn-sm btn-outline-primary me-2">Bewerk</a>
              <form action="{{ url_for('main.delete_poster', poster_id=poster.id) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Weet je zeker dat je deze poster wilt verwijderen?');">Verwijder</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
  {% endif %}

    {# ------------------- KUNST NA POSTERS ------------------- #}
    {% set beschikbare_kunst = kunst | selectattr('sold', 'equalto', False) | list %}
    {% set verkochte_kunst = kunst | selectattr('sold', 'equalto', True) | list %}

    <h4 class="mt-5"> Mijn Kunst</h4>
    {% if beschikbare_kunst %}
      <ul class="list-inline mt-5 mb-4">
        <li class="list-inline-item fw-bold">Mijn Kunst</li>
      </ul>
      <div class="list-group">
        {% for art in beschikbare_kunst %}
          <div class="list-group-item list-group-item-action flex-column align-items-start mb-3 rounded shadow-sm p-3">
            <h5 class="mb-1">{{ art.title }}</h5>
            <small class="text-muted mb-2 d-block">door {{ art.artist }}</small>
            <div class="d-flex align-items-start mb-2">
              {% if art.image_url %}
                <img src="{{ url_for('static', filename='uploads/' ~ art.image_url) }}" alt="Kunstwerk" class="me-3 rounded" style="width: 80px; height: auto; object-fit: cover;">
              {% endif %}
              <div>
                <p class="mb-0">
                  {% if art.description %}
                    {{ art.description.split()[:10] | join(' ') }}...
                  {% else %}
                    Geen beschrijving
                  {% endif %}
                </p>
              </div>
            </div>
            <div class="mt-2">
              <a href="{{ url_for('main.edit_art', art_id=art.id) }}" class="btn btn-sm btn-outline-primary me-2">Bewerk</a>
              <a href="{{ url_for('main.art_analytics', art_id=art.id) }}" class="btn btn-sm btn-outline-info me-2">Analyseer</a>
              <form action="{{ url_for('main.delete_art', art_id=art.id) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Weet je zeker dat je dit kunstwerk wilt verwijderen?');">Verwijder</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
  {% endif %}

  </div>
{% endblock %}
