{% extends "base.html" %}

{% block content %}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="container mt-3">
        {% for category, message in messages %}
          {% if category == 'success' %}
            <div id="flash-messages" class="alert alert-success">{{ message }}</div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="container py-4">
    <div class="d-flex flex-column flex-md-row align-items-center mb-4">
     
      

      <!-- Welkomsttekst en knoppen -->
      <div class="flex-grow-1">
        <h2>Hallo, {{ user.username or "Nieuweling"}}!</h2>
        

        <div class="d-flex flex-wrap mt-2 align-items-center">
  <!-- Bewerk profiel knop -->
  <a href="{{ url_for('main.profile') }}" class="btn btn-primary me-2 mb-2">Bewerk profiel</a>

  <!-- Upgrade knop als formulier -->
  
    {% if user.account_type == "basic" %}
      <a href="{{ url_for('main.upgrade_account') }}" class="btn btn-success me-2 mb-2">
        Upgrade naar Pro
      </a>
    {% endif %}

  
</div>

        </div>
      </div>
    </div>

    <hr>

    <div class="d-flex align-items-center mb-3">
      <h3 class="mb-0 me-3">Mijn Aangekochte Collectie</h3>
    </div>

    <!-- Knoppenrij: Bewerk profiel, Upgrade, Start met zoeken -->
    <div class="d-flex flex-wrap mt-2 align-items-center">
      
     
      <a href="{{ url_for('main.start_search') }}" class="btn btn-lg btn-success me-2 mb-2" style="font-size:1.2rem; padding:0.4rem 1rem;">Start met zoeken</a>
    </div>
    {# Hier kun je later je boeken, postkaarten, posters toevoegen #}

    <h3 class="mt-5">Mijn afspraken</h3>
{% if afspraken and afspraken|length > 0 %}
  <ul class="list-group mb-4">
    {% for afspraak in afspraken %}
      <li class="list-group-item">
        Boek: {{ afspraak.book.title if afspraak.book else '-' }}<br>
        Datum: {{ '%02d-%02d-%04d'|format(afspraak.day, afspraak.month+1, afspraak.year) }}<br>
        Tijd: {{ afspraak.time }}<br>
        <button class="btn btn-sm btn-outline-danger me-2" data-bs-toggle="modal" data-bs-target="#deleteModal{{ afspraak.id }}">Verwijder</button>
        <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#changeModal{{ afspraak.id }}">Wijzig tijdslot</button>

        <!-- Verwijder Modal -->
        <div class="modal fade" id="deleteModal{{ afspraak.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ afspraak.id }}" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <form method="POST" action="{{ url_for('main.delete_appointment', appointment_id=afspraak.id) }}">
                <div class="modal-header">
                  <h5 class="modal-title" id="deleteModalLabel{{ afspraak.id }}">Reden van annulering</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Sluiten"></button>
                </div>
                <div class="modal-body">
                  <textarea name="reden" class="form-control" placeholder="Geef een reden op..." required></textarea>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuleer</button>
                  <button type="submit" class="btn btn-danger">Verwijder afspraak</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Wijzig tijdslot Modal -->
        <div class="modal fade" id="changeModal{{ afspraak.id }}" tabindex="-1" aria-labelledby="changeModalLabel{{ afspraak.id }}" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <form method="POST" action="{{ url_for('main.change_appointment', appointment_id=afspraak.id) }}">
                <div class="modal-header">
                  <h5 class="modal-title" id="changeModalLabel{{ afspraak.id }}">Kies een nieuw tijdslot</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Sluiten"></button>
                </div>
                <div class="modal-body">
                  <select name="nieuw_tijdslot" class="form-select" required>
                    {% for slot in afspraak.book.available_slots %}
                      <option value="{{ slot.id }}">{{ '%02d-%02d-%04d'|format(slot.day, slot.month+1, slot.year) }} om {{ slot.time }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuleer</button>
                  <button type="submit" class="btn btn-primary">Wijzig tijdslot</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <div class="alert alert-info">Je hebt nog geen afspraken gemaakt.</div>
{% endif %}

  </div>
{% endblock %}
